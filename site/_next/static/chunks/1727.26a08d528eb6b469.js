"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1727],{71727:function(e,t,r){r.r(t),r.d(t,{RepayModal:function(){return $}});var n=r(59499),a=r(49501),o=r(23286),s=r(67294),i=r(8195),l=r(31959),u=r(94635),c=r(17674),d=r(75331),p=r(80854),m=r(84707),y=r(82403),b=r(1279),v=r(20854),h=r(29630),f=r(70794),g=r(34220),x=r(46930),S=r(8656),T=r(63206),A=r(53601),j=r(67916),w=r(93608),O=r(57824),k=r(50029),P=r(4730),R=r(87794),B=r.n(R),C=r(56371),E=r(30194),D=r(19419),U=r(28744),Z=r(93591),M=r(77537),N=r(32113),W=r(39771),I=r(31001),L=r(67489),q=r(94671),Q=r(85893),F=["amountToRepay","poolReserve","poolAddress","isWrongNetwork","sx","symbol","debtType","repayWithATokens","blocked","maxApproveNeeded"];function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var H=function(e){var t=e.amountToRepay,r=e.poolReserve,n=e.poolAddress,o=e.isWrongNetwork,l=e.sx,u=e.symbol,m=e.debtType,y=e.repayWithATokens,b=e.blocked,v=e.maxApproveNeeded,h=(0,P.Z)(e,F),f=(0,S.Yh)((function(e){return[e.repay,e.repayWithPermit,e.encodeRepayParams,e.encodeRepayWithPermitParams,e.tryPermit,e.walletApprovalMethodPreference,e.estimateGasLimit,e.addTransaction,e.useOptimizedPath,e.currentMarketData]})),g=(0,c.Z)(f,10),x=g[0],T=g[1],A=g[2],j=g[3],w=g[4],O=g[5],R=g[6],G=g[7],H=g[8],V=g[9],Y=(0,M.Z)().sendTx,z=(0,D.n)(),$=z.refetchGhoData,J=z.refetchIncentiveData,K=z.refetchPoolData,X=(0,s.useState)(),ee=X[0],te=X[1],re=(0,i.vR)(),ne=re.approvalTxState,ae=re.mainTxState,oe=re.loadingTxns,se=re.setMainTxState,ie=re.setTxError,le=re.setGasLimit,ue=re.setLoadingTxns,ce=re.setApprovalTxState,de=(0,Z.y)(V,n),pe=de.data,me=de.refetch,ye=de.isFetching,be=de.isFetchedAfterMount,ve=w({reserveAddress:n,isWrappedBaseAsset:r.isWrappedBaseAsset}),he=ve&&O===N.n.PERMIT;ue(ye);var fe=!y&&0!==Number(t)&&(0,q.iv)({approvedAmount:(null===pe||void 0===pe?void 0:pe.amount)||"0",amount:-1===Number(t)?v:t,signedAmount:ee?ee.amount:"0"});fe&&null!==ne&&void 0!==ne&&ne.success&&ce({});var ge=(0,U.M)({usePermit:he,approvedAmount:pe,requiresApproval:fe,assetAddress:n,symbol:u,decimals:r.decimals,signatureAmount:t,onApprovalTxConfirmed:me,onSignTxCompleted:function(e){return te(e)}}).approval;(0,s.useEffect)((function(){be||y||me()}),[me,be,y]);var xe=function(){var e=(0,k.Z)(B().mark((function e(){var a,o,s,i,l,c,p,b,v;return B().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,se(_(_({},ae),{},{loading:!0})),o=d.UQ.default,!he||!ee){e.next=21;break}if(s={amount:"-1"===t?t:(0,C.parseUnits)(t,r.decimals).toString(),reserve:n,interestRateMode:m,signature:ee.signature,deadline:ee.deadline},!H()){e.next=9;break}return e.next=8,j(s);case 8:i=e.sent;case 9:return o=d.UQ.repayWithPermit,l=T(_(_({},s),{},{encodedTxData:i?i[0]:void 0})),e.next=13,R(l);case 13:return l=e.sent,e.next=16,Y(l);case 16:return a=e.sent,e.next=19,a.wait(1);case 19:e.next=36;break;case 21:if(c={amountToRepay:"-1"===t?t:(0,C.parseUnits)(t,r.decimals).toString(),poolAddress:n,repayWithATokens:y,debtType:m},!H()){e.next=26;break}return e.next=25,A(c);case 25:p=e.sent;case 26:return o=d.UQ.repay,b=x(_(_({},c),{},{encodedTxData:p})),e.next=30,R(b);case 30:return b=e.sent,e.next=33,Y(b);case 33:return a=e.sent,e.next=36,a.wait(1);case 36:se({txHash:a.hash,loading:!1,success:!0}),G(a.hash,{action:o,txState:"success",asset:n,amount:t,assetName:u}),E.queryClient.invalidateQueries({queryKey:I.B.pool}),K&&K(),J&&J(),$&&$(),e.next=49;break;case 44:e.prev=44,e.t0=e.catch(0),v=(0,W.WG)(e.t0,W.aD.GAS_ESTIMATION,!1),ie(v),se({txHash:void 0,loading:!1});case 49:case"end":return e.stop()}}),e,null,[[0,44]])})));return function(){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){var e=0;he?e=Number(p.eB[d.UQ.supplyWithPermit].recommended):(e=Number(p.eB[d.UQ.supply].recommended),fe&&!ne.success&&(e+=Number(q.pQ))),le(e.toString())}),[fe,ne,he,le]),(0,Q.jsx)(L.B,_(_({blocked:b,preparingTransactions:oe||!pe,symbol:r.symbol,mainTxState:ae,approvalTxState:ne,requiresAmount:!0,amount:t,requiresApproval:fe,isWrongNetwork:o,sx:l},h),{},{handleAction:xe,handleApproval:ge,actionText:(0,Q.jsx)(a.cC,{id:"Repay {symbol}",values:{symbol:u}}),actionInProgressText:(0,Q.jsx)(a.cC,{id:"Repaying {symbol}",values:{symbol:u}}),tryPermit:ve}))},V=function(e){var t,r,n,o=e.poolReserve,l=e.userReserve,u=e.symbol,k=e.tokenBalance,P=e.nativeBalance,R=e.isWrongNetwork,B=e.debtType,C=(0,i.vR)(),E=C.gasLimit,D=C.mainTxState,U=C.txError,Z=(0,g.HT)(),M=Z.marketReferencePriceInUsd,N=Z.user,W=(0,x.f)(),I=W.currentChainId,L=W.currentMarketData,q=W.currentMarket,F=(0,S.Yh)((function(e){return[e.poolComputed.minRemainingBaseTokenBalance,e.displayGho]})),G=(0,c.Z)(F,2),_=G[0],V=G[1],Y=(0,s.useState)({address:o.underlyingAsset,symbol:o.symbol,iconSymbol:o.iconSymbol,balance:k}),z=Y[0],$=Y[1],J=(0,s.useState)([z]),K=J[0],X=J[1],ee=(0,s.useState)(""),te=ee[0],re=ee[1],ne=(0,s.useState)(""),ae=ne[0],oe=ne[1],se=(0,s.useRef)(),ie=(0,T.Mo)(I),le=l.underlyingBalance,ue=l.usageAsCollateralEnabledOnUser,ce=l.reserve,de=z.address===o.aTokenAddress,pe=B===d.tk.Stable?(null===l||void 0===l?void 0:l.stableBorrows)||"0":(null===l||void 0===l?void 0:l.variableBorrows)||"0",me=new f.Z(pe).multipliedBy(o.formattedPriceInMarketReferenceCurrency).multipliedBy(M).shiftedBy(-y.$3),ye=(0,b.hE)(pe).multipliedBy("1.0025").decimalPlaces(o.decimals,f.Z.ROUND_UP);if(de)r=f.Z.min(le,pe),n=le;else{var be=(0,b.hE)(z.balance).minus((null===l||void 0===l?void 0:l.reserve.symbol.toUpperCase())===ie.baseAssetSymbol?_:"0");n=be.toString(10),r=f.Z.min(be,pe)}var ve="-1"===ae,he=ve?r.toString(10):ae;(0,s.useEffect)((function(){var e=[];if(o.symbol===ie.wrappedBaseAssetSymbol){var t=(0,b.hE)(P),r=f.Z.max(t,f.Z.min(t,pe));e.push({address:p.hP.toLowerCase(),symbol:ie.baseAssetSymbol,balance:r.toString(10)})}var n=f.Z.min((0,b.hE)(k),pe),a=f.Z.max(n,k);if(o.isVirtual||e.push({address:o.underlyingAsset,symbol:o.symbol,iconSymbol:o.iconSymbol,balance:a.toString(10)}),L.v3&&!V({symbol:o.symbol,currentMarket:q})){var s=(0,b.hE)(le),i=f.Z.max(s,f.Z.min(s,pe).toString(10));e.push({address:o.aTokenAddress,symbol:"pre".concat(o.symbol),iconSymbol:o.iconSymbol,aToken:!0,balance:i.toString(10)})}X(e),$(e[0])}),[]);var fe=(0,b.hE)(pe).minus(he||"0").toString(10),ge=new f.Z(fe).multipliedBy(o.formattedPriceInMarketReferenceCurrency).multipliedBy(M).shiftedBy(-y.$3),xe=ve&&ge.toNumber()>0,Se=null===N||void 0===N?void 0:N.healthFactor;if(he){var Te=(null===N||void 0===N?void 0:N.totalCollateralUSD)||"0";de&&ue&&(Te=(0,b.hE)((null===N||void 0===N?void 0:N.totalCollateralUSD)||"0").minus((0,b.hE)(ce.priceInUSD).multipliedBy(he)));var Ae=(0,b.hE)((null===N||void 0===N?void 0:N.totalBorrowsUSD)||"0").minus((0,b.hE)(ce.priceInUSD).multipliedBy(he)),je=f.Z.max(Ae,0),we=(0,v.L1)({collateralBalanceMarketReferenceCurrency:Te,borrowBalanceMarketReferenceCurrency:je,currentLiquidationThreshold:(null===N||void 0===N?void 0:N.currentLiquidationThreshold)||"0"});Se=we.isLessThan(0)&&!we.eq(-1)?"0":we.toString(10)}var Oe=(0,b.hE)(he).multipliedBy(ce.priceInUSD);return D.success?(0,Q.jsx)(w.R,{action:(0,Q.jsx)(a.cC,{id:"repaid"}),amount:se.current,symbol:de?o.symbol:z.symbol}):(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(A.W,{value:he,onChange:function(e){var t="-1"===e;se.current=t?r.toString(10):e,oe(e),t&&(de||r.eq(pe))?z.address===p.hP.toLowerCase()||m.U[I]&&m.U[I].toLowerCase()===ce.underlyingAsset.toLowerCase()?re(ye.toString(10)):re("-1"):re(ye.lt(n)?ye.toString(10):r.toString(10))},usdValue:Oe.toString(10),symbol:z.symbol,assets:K,onSelect:$,isMaxSelected:ve,maxValue:r.toString(10),balanceText:(0,Q.jsx)(a.cC,{id:"Wallet balance"})}),xe&&(0,Q.jsx)(h.Z,{color:"warning.main",variant:"helperText",children:(0,Q.jsx)(a.cC,{id:"You don\u2019t have enough funds in your wallet to repay the full amount. If you proceed to repay with your current amount of funds, you will still have a small borrowing position in your dashboard."})}),(0,Q.jsxs)(O.m6,{gasLimit:E,children:[(0,Q.jsx)(O.XJ,{description:(0,Q.jsx)(a.cC,{id:"Remaining debt"}),futureValue:fe,futureValueUSD:ge.toString(10),value:pe,valueUSD:me.toString(),symbol:o.iconSymbol===ie.wrappedBaseAssetSymbol?ie.baseAssetSymbol:o.iconSymbol}),(0,Q.jsx)(O.jz,{visibleHfChange:!!ae,healthFactor:null===N||void 0===N?void 0:N.healthFactor,futureHealthFactor:Se})]}),U&&(0,Q.jsx)(j.Q,{txError:U}),(0,Q.jsx)(H,{maxApproveNeeded:ye.toString(),poolReserve:o,amountToRepay:ve?te:he,poolAddress:de?o.underlyingAsset:null!==(t=z.address)&&void 0!==t?t:"",isWrongNetwork:R,symbol:u,debtType:B,repayWithATokens:de})]})};function Y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var $=function(){var e=(0,i.vR)(),t=e.type,r=e.close,n=e.args;return(0,Q.jsx)(l.P,{open:t===i.w8.Repay,setOpen:function(){r()},children:(0,Q.jsx)(u.A,{title:(0,Q.jsx)(a.cC,{id:"Repay"}),underlyingAsset:n.underlyingAsset,requiredPermission:o.g.BORROWER,children:function(e){return(0,Q.jsx)(V,z(z({},e),{},{debtType:n.currentRateMode}))}})})}}}]);